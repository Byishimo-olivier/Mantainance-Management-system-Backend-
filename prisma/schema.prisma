// Prisma schema for Maintenance Management System
// Update provider and credentials in .env as needed

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL")
}

model User {
  id        String   @id @default(auto()) @map("_id")
  name      String
  phone     String   @unique
  email     String   @unique
  password  String
  role      Role
  status    String
  createdAt DateTime @default(now())
}

enum Role {
  ADMIN
  TECH
  CLIENT
}

model MaintenanceRequest {
  id           String   @id @default(auto()) @map("_id")
  clientId     String
  issueType    String
  description  String
  priority     String
  status       String
  assignedTechnicianId String?
  createdAt    DateTime @default(now())
}

model JobEvidence {
  id         String   @id @default(auto()) @map("_id")
  requestId  String
  type       EvidenceType
  imageUrl   String
  uploadedById String
  createdAt  DateTime @default(now())
}

enum EvidenceType {
  BEFORE
  DURING
  AFTER
}

model Material {
  id         String   @id @default(auto()) @map("_id")
  name       String
  quantity   Int
  unitCost   Float
  supplier   String
  lowStockThreshold Int
}

model MaterialRequest {
  id           String   @id @default(auto()) @map("_id")
  technicianId String
  requestId    String
  status       String
}

model MaterialRequestItem {
  id           String   @id @default(auto()) @map("_id")
  materialId   String
  quantity     Int
  materialRequestId String
}

model Procurement {
  id         String   @id @default(auto()) @map("_id")
  supplier   String
  totalCost  Float
  invoiceUrl String
  createdAt  DateTime @default(now())
}

model Subscription {
  id         String   @id @default(auto()) @map("_id")
  clientId   String
  plan       String
  amount     Float
  status     String
  startDate  DateTime
  endDate    DateTime
}

model Payment {
  id         String   @id @default(auto()) @map("_id")
  clientId   String
  amount     Float
  method     String
  reference  String
  status     String
  createdAt  DateTime @default(now())
}
